<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="../../../dijit/themes/claro/claro.css" />
    <meta charset="utf-8">
    <title>Widget tests</title>
</head>
<body class="claro">
	<div id="app"></div>
    <script data-dojo-config="async: 1, isDebug: 1"
            src="../../../dojo/dojo.js"></script>
    <script>
		require([
			"dojo/_base/declare",
			"SkFramework/widgets/Widget",
			"dijit/form/TextBox",
			"dijit/form/Button",
			"SkFramework/widgets/NewList",
		], function(declare, Widget, TextBox, Button, List){

			//widget with only one TextBox
			window.GetLabelWidget1 = declare(Widget, {
				children: {
					label: {
						type: TextBox,
						events: {"change": "displayLabel"},
					},
				},
				displayLabel: function(ev){
					var label = this.getChild("label").get("value");
					console.log("event addLabel fired");
					this.emit("addlabel", {label: label});
				},
				_setDefaultValueAttr: function(value){
					this.getChild("label").set("value", value, false);
				}
			});

			//evolved version of GetLabelWidget1 with a "send" button
			//the app should not have to be impacted by this design modification
			window.GetLabelWidget2 = declare(Widget, {
				children: {
					label: {
						type: TextBox,
					},
					button: {
						type: Button,
						params: {label: "send"},
						events: {click: "displayLabel"},
					}
				},
				displayLabel: function(ev){
					var label = this.getChild("label").get("value");
					console.log("event addLabel fired");
					this.emit("addlabel", {label: label});
				},
				_setDefaultValueAttr: function(value){
					this.getChild("label").set("value", value, false);
				}
			});

			//Todo widget
			window.TodoView = declare(Widget, {
				children: {
					label: {
						type: TextBox,
						events: {change: "updateLabel"},
					},
					button: {
						type: Button,
						params: {label: "remove"},
						events: {click: "removeTodo"},
					}
				},
				removeTodo: function(ev){
					this.emit("remove", {todo: this.todo});
				},
				updateLabel: function(ev){
					var label = this.getChild("label").get("value");
					this.emit("updatelabel", {todo: this.todo, label: label});
				},
				_setTodoAttr: function(todo){
					this.todo = todo;
					this.getChild("label").set("value", todo.label, false);
				}
			});

			window.MyApp = declare(Widget, {
				children: {
					"newTag": {
						type: GetLabelWidget1,
						params: {defaultValue: "new tag"},
						events: {"addlabel": "addTag"}
					},
					"newTodo": {
						type: GetLabelWidget2,
						params: {defaultValue: "new todo"},
						events: {"addlabel": "addTodo"}
					},
					//test for nested children declaration... but in opposite of Enyo, the children of newUser don't belong to myApp
					//in this case, we would like to listen to "click" on the button and get the value from the text box
					//in which way the event bubbling through DOM is usable here ?
/*					newUser: {
						type: Widget,
						params: {
							children: {
								label: {
									type: TextBox,
								},
								button: {
									type: Button,
									params: {label: "add"},
									events: {"click": "addUser"},
								}
							},
						},
					},
*/					todoList: {
						type: List,
						params: {
							items: [{id:1, label: "todo1"}, {id:2, label: "todo2"}],
							title: "Todo list",
							itemPropName: "todo",
							itemViewType: TodoView,
							itemViewParams: {},
						},
						//events emited by TodoView instances (not directly by the list) and capture via bubbling 
						events: {
							remove: "removeTodo",
							updatelabel: "updateLabelTodo",
						},
					}
				},
				addTag: function(ev){
					alert("New tag called "+ ev.label);
				},
				addTodo: function(ev){
					alert("New todo called "+ ev.label);
				},
				addUser: function(ev){
					var label = this.getChild("label").get("value");
					alert("New user called "+ label);
				},
				removeTodo: function(ev){
					console.log("Remove todo called "+ ev.todo.label, ev);
				},
				updateLabelTodo: function(ev){
					console.log("Update label of todo from " + ev.todo.label + " to " + ev.label, ev);
				}
			});

			window.myApp = new MyApp({}, "app");
			myApp.startup();
		});
	</script>
</body>
</html>